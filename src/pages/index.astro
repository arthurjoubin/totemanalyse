---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';
import { sortAnalysesByDate } from '../utils/sort';

const analyses = sortAnalysesByDate(await getCollection('analyses'));
const latestAnalysis = analyses[0];
---

<BaseLayout title="Totem Analyse - Lettre d'Investissement">
  <div class="container mx-auto px-6 py-8 max-w-5xl">
    <Header />

    <!-- Hero Section -->
    <section class="text-center mb-12 pt-4">
      <img src="/images/logo_totem_analyse.png" alt="Totem Analyse Logo" class="w-40 mx-auto mb-8">
      <h1 class="text-4xl font-bold text-totem-green mb-3 tracking-tight">Totem Analyse</h1>
      <p class="text-gray-600 text-lg">Lettre d'Investissement indépendante</p>
      <div class="w-24 h-0.5 bg-totem-green mx-auto mt-6"></div>
    </section>

    <!-- Main CTA -->
    <div class="mb-6">
      <a href="/analyses"
         class="block w-full py-4 px-6 bg-totem-green text-white
                text-center font-semibold text-lg hover:bg-totem-light transition-colors
                duration-200 border border-totem-green">
        Toutes les Analyses
      </a>
    </div>

    <!-- Ticker Banner -->
    <div class="mb-10 border border-gray-200 bg-white overflow-hidden">
      <div class="flex items-center">
        <span class="bg-totem-green text-white text-xs font-semibold px-3 py-2 uppercase tracking-wide shrink-0">
          Analyses
        </span>
        <div class="ticker-wrapper overflow-hidden flex-1">
          <div class="ticker-content flex items-center gap-8 py-2 px-4">
            {analyses.map((analysis) => (
              <a href={`/analyses/${analysis.slug}`} class="ticker-item flex items-center gap-2 text-sm whitespace-nowrap hover:text-totem-green transition-colors">
                <span class="font-semibold text-totem-green">{analysis.data.ticker}</span>
                <span class="text-gray-600">{analysis.data.title.replace('Apparté sur ', '')}</span>
                <span class="text-gray-400">•</span>
              </a>
            ))}
            {analyses.map((analysis) => (
              <a href={`/analyses/${analysis.slug}`} class="ticker-item flex items-center gap-2 text-sm whitespace-nowrap hover:text-totem-green transition-colors">
                <span class="font-semibold text-totem-green">{analysis.data.ticker}</span>
                <span class="text-gray-600">{analysis.data.title.replace('Apparté sur ', '')}</span>
                <span class="text-gray-400">•</span>
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>

    <!-- Latest Analysis -->
    {latestAnalysis && (
      <div class="mb-10">
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-3">Dernière analyse</p>
        <a href={`/analyses/${latestAnalysis.slug}`} class="group block bg-white border border-gray-200 hover:border-totem-green transition-colors">
          <div class="p-5">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-2xl">{latestAnalysis.data.emoji}</span>
              <span class="px-2 py-0.5 bg-totem-green text-white text-xs font-medium">{latestAnalysis.data.ticker}</span>
            </div>
            <h2 class="text-xl font-bold text-gray-900 group-hover:text-totem-green transition-colors mb-2">
              {latestAnalysis.data.title.replace('Apparté sur ', '')}
            </h2>
            <p class="text-gray-600 text-sm mb-3">{latestAnalysis.data.description}</p>
            <p class="text-xs text-gray-500">{latestAnalysis.data.publishDate} · {latestAnalysis.data.readTime}</p>
          </div>
        </a>
      </div>
    )}

    <!-- Portfolio CTA -->
    <div class="mb-6">
      <a href="/portefeuille"
         class="block w-full py-4 px-6 bg-white text-totem-green
                text-center font-semibold text-lg hover:bg-gray-50 transition-colors
                duration-200 border border-totem-green">
        Notre Portefeuille & Watchlist
      </a>
    </div>

    <!-- Newsletter Signup -->
    <div class="mb-10">
      <div class="bg-white border border-gray-200 p-6 text-center">
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-2">Newsletter</p>
        <h3 class="text-lg font-bold text-gray-900 mb-2">Recevez nos analyses</h3>
        <p class="text-sm text-gray-600 mb-4">Une analyse approfondie par mois, directement dans votre boîte mail.</p>
        <a href="https://totemanalyse.substack.com/subscribe"
           target="_blank"
           rel="noopener noreferrer"
           class="inline-block py-3 px-8 bg-totem-green text-white font-medium hover:bg-totem-light transition-colors">
          S'abonner gratuitement →
        </a>
      </div>
    </div>

    <!-- Social Links -->
    <div class="grid grid-cols-2 gap-4 mb-16">
      <a href="https://twitter.com/TotemAnalyse" target="_blank" rel="noopener noreferrer"
         class="block py-3 px-4 bg-white border border-gray-300 text-gray-700
                text-center font-medium hover:border-totem-green hover:text-totem-green
                transition-colors duration-200 text-sm">
        Twitter / X
      </a>

      <a href="https://totemanalyse.substack.com" target="_blank" rel="noopener noreferrer"
         class="block py-3 px-4 bg-white border border-gray-300 text-gray-700
                text-center font-medium hover:border-totem-green hover:text-totem-green
                transition-colors duration-200 text-sm">
        Substack
      </a>
    </div>

    <Footer />
  </div>
</BaseLayout>

<style>
  .ticker-wrapper {
    mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
  }

  .ticker-content {
    animation: ticker 20s linear infinite;
  }

  .ticker-content:hover {
    animation-play-state: paused;
  }

  @keyframes ticker {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
</style>
