---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { sortAnalysesByDate } from '../utils/sort';

const analyses = sortAnalysesByDate(await getCollection('analyses'));
const latestAnalysis = analyses[0];
---

<BaseLayout title="Totem Analyse - Lettre d'Investissement">
  <div class="container mx-auto px-6 py-12 max-w-3xl">
    <!-- Logo and Header -->
    <header class="text-center mb-12 pt-8">
      <img src="/images/logo_totem_analyse.png" alt="Totem Analyse Logo" class="w-40 mx-auto mb-8">
      <h1 class="text-4xl font-bold text-totem-green mb-3 tracking-tight">Totem Analyse</h1>
      <p class="text-gray-600 text-lg">Lettre d'Investissement indÃ©pendante</p>
      <div class="w-24 h-0.5 bg-totem-green mx-auto mt-6"></div>
    </header>

    <!-- Main CTA -->
    <div class="mb-6">
      <a href="/analyses"
         class="block w-full py-4 px-6 bg-totem-green text-white
                text-center font-semibold text-lg hover:bg-totem-light transition-colors
                duration-200 border border-totem-green">
        Toutes les Analyses
      </a>
    </div>

    <!-- Ticker Banner -->
    <div class="mb-10 border border-gray-200 bg-white overflow-hidden">
      <div class="flex items-center">
        <span class="bg-totem-green text-white text-xs font-semibold px-3 py-2 uppercase tracking-wide shrink-0">
          Analyses
        </span>
        <div class="ticker-wrapper overflow-hidden flex-1">
          <div class="ticker-content flex items-center gap-8 py-2 px-4">
            {analyses.map((analysis) => (
              <a href={`/analyses/${analysis.slug}`} class="ticker-item flex items-center gap-2 text-sm whitespace-nowrap hover:text-totem-green transition-colors">
                <span class="font-semibold text-totem-green">{analysis.data.ticker}</span>
                <span class="text-gray-600">{analysis.data.title.replace('AppartÃ© sur ', '')}</span>
                <span class="text-gray-400">â€¢</span>
              </a>
            ))}
            {analyses.map((analysis) => (
              <a href={`/analyses/${analysis.slug}`} class="ticker-item flex items-center gap-2 text-sm whitespace-nowrap hover:text-totem-green transition-colors">
                <span class="font-semibold text-totem-green">{analysis.data.ticker}</span>
                <span class="text-gray-600">{analysis.data.title.replace('AppartÃ© sur ', '')}</span>
                <span class="text-gray-400">â€¢</span>
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>

    <!-- Latest Analysis -->
    {latestAnalysis && (
      <div class="mb-10">
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-3">DerniÃ¨re analyse</p>
        <a href={`/analyses/${latestAnalysis.slug}`} class="group block bg-white border border-gray-200 hover:border-totem-green transition-colors">
          <div class="p-5">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-2xl">{latestAnalysis.data.emoji}</span>
              <span class="px-2 py-0.5 bg-totem-green text-white text-xs font-medium">{latestAnalysis.data.ticker}</span>
            </div>
            <h2 class="text-xl font-bold text-gray-900 group-hover:text-totem-green transition-colors mb-2">
              {latestAnalysis.data.title.replace('AppartÃ© sur ', '')}
            </h2>
            <p class="text-gray-600 text-sm mb-3">{latestAnalysis.data.description}</p>
            <p class="text-xs text-gray-500">{latestAnalysis.data.publishDate} Â· {latestAnalysis.data.readTime}</p>
          </div>
        </a>
      </div>
    )}

    <!-- Portfolio Section -->
    <div class="mb-10">
      <p class="text-xs text-gray-500 uppercase tracking-wide mb-3">Notre Portefeuille</p>
      <div class="bg-white border border-gray-200">
        <!-- Header -->
        <div class="flex items-center justify-between px-5 py-3 border-b border-gray-100 bg-gray-50">
          <span class="text-xs text-gray-500 uppercase tracking-wide font-medium">Position</span>
          <span class="text-xs text-gray-500 uppercase tracking-wide font-medium">Poids</span>
        </div>

        <!-- Position 1 - Harris Technology -->
        <div class="portfolio-item group border-b border-gray-100 last:border-b-0">
          <div class="flex items-center justify-between px-5 py-4">
            <div class="flex items-center gap-4">
              <span class="rank-number text-2xl font-bold text-totem-green">1</span>
              <div>
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-semibold text-gray-900">Harris Technology</span>
                  <span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium">HT8</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-500">ðŸ‡¦ðŸ‡º ASX</span>
                  <span class="text-xs text-gray-400">â€¢</span>
                  <span class="text-xs text-amber-600">Analyse Ã  venir</span>
                </div>
              </div>
            </div>
            <div class="weight-bar w-24">
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-totem-green rounded-full" style="width: 100%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Position 2 - Snack Empire -->
        <a href="/analyses/snack-empire" class="portfolio-item group border-b border-gray-100 last:border-b-0 block hover:bg-gray-50 transition-colors">
          <div class="flex items-center justify-between px-5 py-4">
            <div class="flex items-center gap-4">
              <span class="rank-number text-2xl font-bold text-totem-green">2</span>
              <div>
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-semibold text-gray-900 group-hover:text-totem-green transition-colors">Snack Empire</span>
                  <span class="px-2 py-0.5 bg-totem-green text-white text-xs font-medium">AWH</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-500">ðŸ‡¸ðŸ‡¬ SGX</span>
                  <span class="text-xs text-gray-400">â€¢</span>
                  <span class="text-xs text-totem-green font-medium">Voir l'analyse â†’</span>
                </div>
              </div>
            </div>
            <div class="weight-bar w-24">
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-totem-green rounded-full" style="width: 70%"></div>
              </div>
            </div>
          </div>
        </a>

        <!-- Position 3 - Duolingo -->
        <a href="/analyses/duolingo" class="portfolio-item group block hover:bg-gray-50 transition-colors">
          <div class="flex items-center justify-between px-5 py-4">
            <div class="flex items-center gap-4">
              <span class="rank-number text-2xl font-bold text-totem-green">3</span>
              <div>
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-semibold text-gray-900 group-hover:text-totem-green transition-colors">Duolingo</span>
                  <span class="px-2 py-0.5 bg-totem-green text-white text-xs font-medium">DUOL</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-500">ðŸ‡ºðŸ‡¸ NASDAQ</span>
                  <span class="text-xs text-gray-400">â€¢</span>
                  <span class="text-xs text-totem-green font-medium">Voir l'analyse â†’</span>
                </div>
              </div>
            </div>
            <div class="weight-bar w-24">
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-totem-green rounded-full" style="width: 50%"></div>
              </div>
            </div>
          </div>
        </a>
      </div>
      <p class="text-xs text-gray-400 mt-2 text-center italic">ClassÃ© par taille de position</p>
    </div>

    <!-- Description -->
    <div class="mb-10 text-center">
      <p class="text-gray-600 leading-relaxed text-sm">
        Recherche fondamentale, valorisation et thÃ¨ses d'investissement sur des entreprises cotÃ©es.
      </p>
    </div>

    <!-- Social Links -->
    <div class="grid grid-cols-2 gap-4 mb-16">
      <a href="https://twitter.com/TotemAnalyse" target="_blank" rel="noopener noreferrer"
         class="block py-3 px-4 bg-white border border-gray-300 text-gray-700
                text-center font-medium hover:border-totem-green hover:text-totem-green
                transition-colors duration-200 text-sm">
        Twitter / X
      </a>

      <a href="https://totemanalyse.substack.com" target="_blank" rel="noopener noreferrer"
         class="block py-3 px-4 bg-white border border-gray-300 text-gray-700
                text-center font-medium hover:border-totem-green hover:text-totem-green
                transition-colors duration-200 text-sm">
        Substack
      </a>
    </div>

    <!-- Footer -->
    <footer class="text-center text-gray-500 text-sm border-t border-gray-200 pt-8">
      <p>Â© 2025 Totem Analyse</p>
      <p class="mt-2 text-xs">Ceci n'est pas un conseil en investissement.</p>
    </footer>
  </div>
</BaseLayout>

<style>
  .ticker-wrapper {
    mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
  }

  .ticker-content {
    animation: ticker 20s linear infinite;
  }

  .ticker-content:hover {
    animation-play-state: paused;
  }

  @keyframes ticker {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
</style>
