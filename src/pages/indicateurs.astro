---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ChartCard from '../components/ChartCard.astro';
---

<BaseLayout title="Indicateurs Clés - Totem Analyse" description="Évolution sur 20 ans des principaux indicateurs économiques et financiers">
  <div class="container mx-auto px-6 py-8 max-w-6xl">
    <Header />

    <main>
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Indicateurs Clés</h1>
        <p class="text-gray-600">Évolution sur 20 ans des principaux indicateurs économiques et financiers</p>
        <p class="text-xs text-gray-400 mt-2" id="last-updated"></p>
      </div>

      <!-- Contrôles globaux de timeline -->
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-8">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
          <span class="text-sm font-medium text-gray-700">Période d'affichage pour tous les graphiques :</span>
          <div class="flex gap-2" id="global-time-controls">
            <button
              data-range="1y"
              class="px-4 py-2 text-sm rounded transition-colors bg-gray-100 text-gray-600 hover:bg-gray-200"
            >
              1 an
            </button>
            <button
              data-range="5y"
              class="px-4 py-2 text-sm rounded transition-colors bg-gray-100 text-gray-600 hover:bg-gray-200"
            >
              5 ans
            </button>
            <button
              data-range="10y"
              class="px-4 py-2 text-sm rounded transition-colors bg-totem-green text-white"
            >
              10 ans
            </button>
            <button
              data-range="20y"
              class="px-4 py-2 text-sm rounded transition-colors bg-gray-100 text-gray-600 hover:bg-gray-200"
            >
              20 ans
            </button>
          </div>
        </div>
      </div>

      <!-- Indices Boursiers -->
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Indices Boursiers</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <ChartCard indicatorKey="sp500" color="#006B4F" name="S&P 500" />
          <ChartCard indicatorKey="nasdaq" color="#00d4aa" name="NASDAQ" />
          <ChartCard indicatorKey="cac40" color="#1e40af" name="CAC 40" />
          <ChartCard indicatorKey="dax" color="#dc2626" name="DAX" />
          <ChartCard indicatorKey="nikkei" color="#ec4899" name="Nikkei 225" />
        </div>
      </section>

      <!-- Matières Premières -->
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Matières Premières</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <ChartCard indicatorKey="gold" color="#ca8a04" name="l'Or" />
          <ChartCard indicatorKey="silver" color="#94a3b8" name="l'Argent" />
          <ChartCard indicatorKey="brent" color="#0f172a" name="le Brent" />
          <ChartCard indicatorKey="natgas" color="#0ea5e9" name="le Gaz Naturel" />
        </div>
      </section>

      <!-- Devises -->
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Devises</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <ChartCard indicatorKey="eurusd" color="#2563eb" name="EUR/USD" />
        </div>
      </section>

      <!-- Taux et Obligations -->
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Taux et Obligations</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <ChartCard indicatorKey="fr10y" color="#dc2626" name="le Taux US 10 ans" />
        </div>
      </section>

      <!-- Crypto -->
      <section class="mb-10">
        <div class="flex items-center gap-3 mb-4">
          <h2 class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Cryptomonnaies</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <ChartCard indicatorKey="bitcoin" color="#f7931a" name="le Bitcoin" />
        </div>
      </section>

      <!-- Note sur les données -->
      <section class="mb-10">
        <div class="bg-gray-50 border border-gray-200 p-6">
          <h3 class="font-semibold text-gray-900 mb-2">Sources des données</h3>
          <p class="text-sm text-gray-600 mb-3">
            Les données sont mises à jour automatiquement via GitHub Actions. Sources utilisées :
          </p>
          <ul class="text-sm text-gray-600 list-disc pl-5 space-y-1">
            <li><strong>Indices boursiers</strong> — Yahoo Finance (S&P 500, CAC 40)</li>
            <li><strong>Matières premières</strong> — Yahoo Finance (Or, Brent)</li>
            <li><strong>Cryptomonnaies</strong> — Yahoo Finance (Bitcoin)</li>
            <li><strong>Taux</strong> — Yahoo Finance (US 10 ans)</li>
          </ul>
        </div>
      </section>

      <!-- Back link -->
      <div class="text-center">
        <a href="/" class="text-totem-green hover:text-totem-light text-sm font-medium">
          ← Retour à l'accueil
        </a>
      </div>
    </main>

    <Footer />
  </div>
</BaseLayout>

<script>
  // Afficher la date de dernière mise à jour
  fetch('/data/indicators.json')
    .then(res => res.json())
    .then(data => {
      const el = document.getElementById('last-updated');
      if (el && data.lastUpdated) {
        const date = new Date(data.lastUpdated);
        el.textContent = `Données mises à jour le ${date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}`;
      }
    });

  // Gérer les contrôles globaux de timeline
  const globalControls = document.getElementById('global-time-controls');
  if (globalControls) {
    const buttons = globalControls.querySelectorAll('button');

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        const range = button.getAttribute('data-range');

        // Mettre à jour l'apparence des boutons
        buttons.forEach(btn => {
          if (btn === button) {
            btn.className = 'px-4 py-2 text-sm rounded transition-colors bg-totem-green text-white';
          } else {
            btn.className = 'px-4 py-2 text-sm rounded transition-colors bg-gray-100 text-gray-600 hover:bg-gray-200';
          }
        });

        // Émettre un événement personnalisé pour informer les composants
        const event = new CustomEvent('globalTimeRangeChange', { detail: { range } });
        window.dispatchEvent(event);
      });
    });
  }
</script>
