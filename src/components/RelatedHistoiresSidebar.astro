---
import { getCollection } from 'astro:content';
import { sortHistoiresByDate } from '../utils/sort';

interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;

const allHistoires = sortHistoiresByDate(await getCollection('histoires'));
const relatedHistoires = allHistoires.filter((histoire) => histoire.slug !== currentSlug);
---

{relatedHistoires.length > 0 && (
  <aside class="space-y-3">
    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide px-4">Autres histoires</h3>
    <div class="space-y-2">
      {relatedHistoires.map((histoire) => (
        <a
          href={`/histoires/${histoire.slug}`}
          class="flex items-start gap-3 p-3 bg-white border border-gray-200 hover:border-amber-500 hover:bg-amber-50 transition-all duration-200 group"
        >
          <span class="text-3xl flex-shrink-0 mt-0.5">{histoire.data.emoji}</span>
          <div class="flex-1 min-w-0">
            <h4 class="text-sm font-semibold text-gray-900 group-hover:text-amber-600 transition-colors leading-tight">
              {histoire.data.title}
            </h4>
            <div class="flex flex-wrap gap-1 mt-1">
              {histoire.data.series && (
                <span class="inline-block px-2 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium">
                  {histoire.data.series}
                </span>
              )}
              {histoire.data.tags.slice(0, 1).map((tag: string) => (
                <span class="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 text-xs">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        </a>
      ))}
    </div>
  </aside>
)}
